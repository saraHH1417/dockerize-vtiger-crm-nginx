/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
jQuery.Class("Settings_Customer_Portal_Js",{},{customerPortalForm:!1,rowClass:"portalModuleRow",getForm:function(){return 0==this.customerPortalForm&&(this.customerPortalForm=jQuery("#customerPortalForm")),this.customerPortalForm},makeModulesListSortable:function(){var e=this,t=jQuery("#portalModulesTable");t.sortable({containment:t,items:"tr."+this.rowClass,revert:!0,tolerance:"pointer",dealy:"3000",helper:function(e,t){return t.children().each(function(e,t){(t=jQuery(t)).width(t.width())}),t},update:function(t,o){e.showSaveButton()}})},showSaveButton:function(){var e=this.getForm().find('[name="savePortalInfo"]');"disabled"==e.attr("disabled")&&e.removeAttr("disabled")},disableSaveButton:function(e){e.find('[name="savePortalInfo"]').attr("disabled","disabled")},updatePortalModulesListByOrder:function(){var e=this.getForm();jQuery("tr."+this.rowClass,e).each(function(e,t){var o=jQuery(t),r=o.data("id"),n=o.find('[name="portalModulesInfo['+r+'][sequence]"]'),a=e+1;if(a!=n.val())return n.val(a)})},saveCustomerPortal:function(e){var t=jQuery.Deferred(),o=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),r=e.serializeFormData();return r.module=app.getModuleName(),r.parent=app.getParentModuleName(),r.action="CustomerPortal",AppConnector.request(r).then(function(e){o.progressIndicator({mode:"hide"}),t.resolve(e)},function(e){o.progressIndicator({mode:"hide"}),t.reject(e)}),t.promise()},registerEvents:function(e){var t=this,o=t.getForm();app.showSelect2ElementView(o.find("select.select2"),{maximumSelectionSize:7,dropdownCss:{"z-index":0}}),t.makeModulesListSortable(),o.find("select.select2").on("change",function(){t.showSaveButton()}),o.find("input:checkbox, input:radio").on("change",function(){t.showSaveButton()}),o.submit(function(e){e.preventDefault(),t.disableSaveButton(o),t.updatePortalModulesListByOrder(),t.saveCustomerPortal(o).then(function(e){e.result.success&&app.helper.showSuccessNotification({message:app.vtranslate("JS_PORTAL_INFO_SAVED")})},function(e){})})}}),jQuery(document).ready(function(){(new Settings_Customer_Portal_Js).registerEvents()});