/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
var InventoryModulesNames=["Invoice","Quotes","PurchaseOrder","SalesOrder"];InventoryModulesNames.includes(app.getModuleName())&&$(".saveButton").addClass("hide");var Vtiger_ParsVT_Js={detailViewContentHolder:!1,getContentHolder:function(){return 0==this.detailViewContentHolder&&(this.detailViewContentHolder=jQuery("div.details div.contents")),this.detailViewContentHolder},getSelectedTab:function(){return this.getTabContainer().find("li.active")},getTabContainer:function(){return jQuery("div.related")},getRelatedModuleName:function(){return jQuery(".relatedModuleName",this.getContentHolder()).val()},getRecordId:function(){return jQuery("#recordId").val()},ClearCampaign:function(e,t){var a=this,r="module=ParsVT&action=ListDelete&campaign="+e+"&list="+t;AppConnector.request(r+"&mode=control").then(function(e){if(1==e.result.success){var n=e.result.message;app.helper.showConfirmationBox({message:n}).then(function(e){AppConnector.request(r).then(function(e){1==e.success&&(1==e.result.success?(app.helper.showSuccessNotification({message:e.result.message}),setTimeout(function(){window.location.reload(1)},3e3)):app.helper.showErrorNotification({message:e.result.message}));var r=a.getSelectedTab(),n=a.getRelatedModuleName();if(selectedTabLabelKey=r.data("label-key"),selectedTabLabelKey==t){new Campaigns_RelatedList_Js(a.getRecordId(),app.getModuleName(),r,n).loadRelatedList()}})},function(e,t){})}else app.helper.showErrorNotification({message:e.result.message})})},getVtigerVersion:function(){for(var e="",t=document.getElementsByTagName("script"),a=0;a<t.length;++a){var r=t[a].src;if(r.indexOf(".js?v=")>-1){e=(n=r.split("js?v="))[1];break}if(r.indexOf(".js?&v=")>-1){var n=r.split(".js?&v=");e=n[1];break}}return e},versionCompare:function(e,t,a){function r(e){return(n?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}var n=a&&a.lexicographical,i=a&&a.zeroExtend,s=e.split("."),o=t.split(".");if(!s.every(r)||!o.every(r))return NaN;if(i){for(;s.length<o.length;)s.push("0");for(;o.length<s.length;)o.push("0")}n||(s=s.map(Number),o=o.map(Number));for(var l=0;l<s.length;++l){if(o.length==l)return 1;if(s[l]!=o[l])return s[l]>o[l]?1:-1}return s.length!=o.length?-1:0},registerTopMenu:function(e,t){var a=this.getVtigerVersion(),r="";this.versionCompare(a,"7.0.0")>=0&&(r="<style>#page{padding-top: 124px;} @media (min-width: 1000px){#page{padding-top: 124px;}}</style>");var n='<div id="LicenseToolbar" class="row" style="background: #2c3b49;color: red;directories:rtl;"><div class="col-lg-1 col-md-1"><span class="fa fa-bullhorn" style="font-size: 26px;color: #fff;background: #c22f2f;padding: 7px 8px;"></span></div><div class="col-lg-7 col-md-7" style="font-size: 12px;text-align: center;line-height: 30px!important;color: #fff;"><p id="mytext"></p><p id="console"></p></div><div class="col-lg-4 col-md-4"><span id="CloseLicenseToolbar" class="fa fa-remove" style="cursor: pointer;;font-size: 26px;color: #fff;background: #c22f2f;padding: 7px 8px;float:'+("fa"==jQuery("body").data("language").substring(0,2)||"ar"==jQuery("body").data("language").substring(0,2)?"left":"right")+'"></span><button type="button"  onclick="window.open(\'http://my.vtiger.ir/submitticket.php?step=2&deptid=8\')" class="btn btn-warning btn-lg custom-header-btn-preview pull-right" style="position: relative; border-radius: 2px !important;height:38px;margin-left:10px;"><span style="line-height: 24px; font-size: 11px; padding: 0px;height: 38px;">'+t[0]+'</span><button type="button" onclick="window.location.href=\'index.php?module=ParsVT&parent=Settings&view=License\'" class="btn btn-success btn-lg custom-header-btn-purchase pull-right" style="position: relative; border-radius: 2px !important;margin-left:10px;height:38px;"><span style="line-height: 24px; font-size: 11px; padding: 0px;height: 38px;">'+t[1]+'</span></button></div></div><div style="clear: both;"></div>'+r;$(".global-nav").before(n),this.consoleText(e,"mytext",["Snow","yellow"])},requestCheckSalahTimes:function(){var e={};e.action="ActionAjax",e.module="ParsVT",e.mode="isAdhanTime",app.request.post({data:e}).then(function(e,t){if(null==e){if(!t.result.result)return!1;Vtiger_ParsVT_Js.ShowAdhanNotification(t.result.message,t.result.next,t.result.title,t.result.mp3)}})},checkPermissionForAdhan:function(){var e={};e.action="ActionAjax",e.module="ParsVT",e.mode="checkPermissionForAdhan",app.request.post({data:e}).then(function(e,t){if(null==e&&t&&t.result){Vtiger_ParsVT_Js.registerSalah()||setInterval(function(){Vtiger_ParsVT_Js.registerSalah()},6e4)}})},registerSalah:function(){var e=app.storage.get("Adhan"),t=Math.round((new Date).getTime()/1e3);if(null!==e&&t<e+300)return!1;Vtiger_ParsVT_Js.requestCheckSalahTimes()},registerSettingsBtn:function(){var e={};e.action="ActionAjax",e.module="ParsVT",e.mode="checkEnable","Detail"!=app.view()&&"PreferenceDetail"!=app.view()||"Users"!=app.getModuleName()||app.request.post({data:e}).then(function(e,t){if(null==e&&"1"==t.enable){for(var a="",r="",n=window.location.search.substring(1).split("&"),i=0;i<n.length;i++){var s=n[i].split("=");"module"==s[0]?a=s[1]:"view"==s[0]?r=s[1]:"record"==s[0]&&s[1]}if("Users"==a&&("Detail"==r||"PreferenceDetail"==r)){var o=jQuery(".detailViewContainer").find(".btn-group"),l=jQuery(t.button);o.find(".btn-default:last").before(l)}}})},registerStartParsVT:function(){var e=this,t={};t.action="ActionAjax",t.module="ParsVT",t.mode="registerHelp";var a=jQuery(".navbar-nav .register_help_btn");jQuery(window).width()>=900&&0==a.length&&app.request.post({data:t}).then(function(t,a){if(null==t&&"1"==a.enable){for(var r="",n=window.location.search.substring(1).split("&"),i=0;i<n.length;i++){var s=n[i].split("=");"module"==s[0]?r=s[1]:"view"==s[0]?s[1]:"record"==s[0]&&s[1]}var o=jQuery(".module-action-content").find(".navbar-right");$("<style type='text/css'>.register_help_btn{margin-top:3px;outline:0;display:inline-flex;align-items:center;justify-content:space-between;background:#ef5e29;min-width:100px;border:0;border-radius:4px;box-shadow:0 4px 12px rgba(0,0,0,0.1);box-sizing:border-box;padding:8px 10px;color:#FFF;font-size:12px;font-weight:600;text-transform:uppercase;overflow:hidden;cursor:pointer}.register_help_btn:focus .dropdown,.register_help_btn:active .dropdown{-webkit-transform:translate(0,20px);transform:translate(0,20px);opacity:1;visibility:visible}.register_help_btn .material-icons{border-radius:100%;-webkit-animation:ripple .6s linear infinite;animation:ripple .6s linear infinite}@-webkit-keyframes ripple{0%{box-shadow:0 0 0 0 rgba(255,255,255,0.1),0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1)}100%{box-shadow:0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1),0 0 0 80px rgba(255,255,255,0)}}@keyframes ripple{0%{box-shadow:0 0 0 0 rgba(255,255,255,0.1),0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1)}100%{box-shadow:0 0 0 20px rgba(255,255,255,0.1),0 0 0 40px rgba(255,255,255,0.1),0 0 0 60px rgba(255,255,255,0.1),0 0 0 80px rgba(255,255,255,0)}} </style>").appendTo("head"),"Reports"==r?o.append(a.button):o.find(".navbar-nav").append(a.button),e.registerEventForHelper(),e.registerEventgetPageVideo()}})},registerEventForHelper:function(){jQuery(".module-action-content").on("click",".register_help_btn",function(e){if(jQuery("#helperContainer").length>0)return app.helper.hidePageOverlay(),!1;var t={module:"ParsVT",view:"Helper",mode:"showHelperView",data:{module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName()}};app.helper.showProgress(),app.request.post({data:t}).then(function(e,t){app.helper.hideProgress(),null===e?app.helper.loadPageOverlay(t,{ignoreScroll:!0,backdrop:"static"}).then(function(){$("#overlayPage").find(".data").css("height","300vh"),$("#overlayPage").css("top","85px");var e=jQuery(".register_help_btn").offset();$("#overlayPage").find(".arrow").css("left",e.left+35),$("#overlayPage").find(".arrow").addClass("show"),$("#overlayPage").find(".modal-body").css("overflow","auto");var t=$(".modal-header");t.position();if(app.helper.showVerticalScroll(jQuery(".modal-body"),{setHeight:window.innerHeight-85-t.height()+"px"}),$(".modal-body").removeClass("overflowYAuto"),jQuery("#ticketdepartment").length>0){var a=jQuery("#ticketdepartment");vtUtils.showSelect2ElementView(a,{})}}):app.helper.showErrorNotification({message:e})})})},registerEventgetPageVideo:function(){jQuery("body").on("click",".pars_video_category_btn",function(e){var t=$("#parscategory").children().clone();$("#HelperTutorials").empty(),$("#HelperTutorials").append(t)}),jQuery("body").on("click",".pars_video_refresh_btn",function(e){app.helper.showProgress(),app.request.post({data:{module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"SetRefreshVideoList"}}).then(function(e,t){null===e?(app.helper.hideProgress(),app.helper.showSuccessNotification({message:t.message}),$(".pars_video_refresh_btn").css("display","none"),window.setTimeout(function(){$("button.close").trigger("click")},3e3)):app.helper.showErrorNotification({message:e})})}),jQuery("body").on("click",".subvideo",function(e){var t=$(this).data("id"),a={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"getHelperPageVideo",data:{id:t}};app.helper.showProgress(),app.request.post({data:a}).then(function(e,a){if(null===e){app.helper.hideProgress();var r=null,n={};$.each(a.message[0],function(e,a){a.id==t?r=a:n[a.id]=a});var i="";i="URL"==r.upload_type?r.path_video:'<video width="100%" controls controlsList="nodownload"> <source src="'+r.path_video+'" type="video/mp4"></video>';var s="";if(Object.keys(n).length>=1){l="";$.each(n,function(e,t){var a="http://license.aweb.co/videos/default_video.png";""!=t.path_picture&&(a=t.path_picture),l=(l+='<div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t.title+"</div></div>",l=l+'<div class="panel-body subvideo" data-id="'+e+'"><img class="parsvideoimage" src="'+a+'" width="100%"><button class="btn btn-primary pars_video_btn" data-id="'+e+'" style="margin: 10px">'+t.title+"</button></div>",l+="</div>"}),s="<span>"+PVTHelpers.tr9+'</span>\n<br>\n<div class="pars_video_div">\n'+l+"\n</div>"}$(".pars_video_div").empty(),$(".pars_video_div").append(s);var o="";if(""!=r.related_video[0]){var l="";$.each(r.related_video,function(e,t){l=(l=(l+='<div class="col-lg-3"><div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t+"</div></div>")+'<div class="panel-body  subrelvideo"  data-name="'+t+'"><img class="parsvideoimage" src="http://license.aweb.co/videos/default_video.png" width="100%"><button class="btn btn-primary pars_relatedvideo_btn" data-name="'+t+'" style="margin: 10px">'+t+"</button></div>",l+="</div></div>"}),o='<div class="pars_relatedvideo_div">\n<hr>\n<span>'+PVTHelpers.tr1+"</span>\n<br>\n"+l+"\n</div>"}var d='<div class="row-fluid pars_video_source">\n<h2>'+r.title+"</h2>\n"+i+"\n<span>"+r.comment+"</span>\n</div>\n<br>\n"+o;$("#HelperTutorials").empty(),$("#HelperTutorials").append(d)}else app.helper.showErrorNotification({message:e})})}),jQuery("body").on("click",".subrelvideo",function(e){var t=$(this).data("name"),a={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"getHelperPageVideo",data:{name:t}};app.helper.showProgress(),app.request.post({data:a}).then(function(e,a){if(null===e){app.helper.hideProgress();var r=null,n={};$.each(a.message[0],function(e,a){a.title==t?r=a:n[a.id]=a});var i="";i="URL"==r.upload_type?r.path_video:'<video width="100%" controls controlsList="nodownload"> <source src="'+r.path_video+'" type="video/mp4"></video>';var s="";if(Object.keys(n).length>=1){l="";$.each(n,function(e,t){var a="http://license.aweb.co/videos/default_video.png";""!=t.path_picture&&(a=t.path_picture),l=(l+='<div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t.title+"</div></div>",l=l+'<div class="panel-body subvideo" data-id="'+e+'"><img class="parsvideoimage" src="'+a+'" width="100%"><button class="btn btn-primary pars_video_btn" data-id="'+e+'" style="margin: 10px">'+t.title+"</button></div>",l+="</div>"}),s="<span>"+PVTHelpers.tr9+'</span>\n<br>\n<div class="pars_video_div">\n'+l+"\n</div>"}$(".pars_video_div").empty(),$(".pars_video_div").append(s);var o="";if(""!=r.related_video[0]){var l="";$.each(r.related_video,function(e,t){l=(l=(l+='<div class="col-lg-3"><div class="panel panel-default">')+'<div class="panel-footer"><i class="fa fa-video-camera" aria-hidden="true"></i><div class="title">'+t+"</div></div>")+'<div class="panel-body  subrelvideo"  data-name="'+t+'"><img src="http://license.aweb.co/videos/default_video.png" width="100%"><button class="btn btn-primary pars_relatedvideo_btn" data-name="'+t+'" style="margin: 10px">'+t+"</button></div>",l+="</div></div>"}),o='<div class="pars_relatedvideo_div">\n<hr>\n<span>'+PVTHelpers.tr1+"</span>\n<br>\n"+l+"\n</div>"}var d='<div class="row-fluid pars_video_source">\n<h2>'+r.title+"</h2>\n"+i+"\n<span>"+r.comment+"</span>\n</div>\n<br>\n"+o;$("#HelperTutorials").empty(),$("#HelperTutorials").append(d)}else app.helper.showErrorNotification({message:e})})}),jQuery("body").on("click",".helper_ticket_button",function(e){var t=$('input[name = "ticketsubject"]').val(),a=$('textarea[name = "ticketcontent"]').val(),r=$("#ticketdepartment").val(),n={subject:t,content:a,department:r},i=!1;if($('input[name = "ticketsubject"]').css("border","1px solid #cccccc"),$('textarea[name = "ticketcontent"]').css("border","1px solid #ff0000;"),$('input[name = "ticketdepartment"]').css("border","1px solid #ff0000;"),""===t?($('input[name = "ticketsubject"]').css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0):""===a?($('textarea[name = "ticketcontent"]').css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0):""===r&&($("#ticketdepartment").css("border","1px solid #ff0000"),app.helper.showErrorNotification({message:app.vtranslate("JS_REQUIRED_FIELD")}),i=!0),!0!==i){var s={module:"ParsVT",view:"Helper",action:"ActionAjax",mode:"sendTicket",data:n};app.helper.showProgress(),app.request.post({data:s}).then(function(e,t){app.helper.hideProgress(),null===e?(t.success?app.helper.showSuccessNotification({message:PVTHelpers.tr2}):app.helper.showSuccessNotification({message:PVTHelpers.tr3}),$("#parsvtticket").html(t.message)):app.helper.showSuccessNotification({message:PVTHelpers.tr3})})}}),jQuery("body").on("click",".Tutorials",function(e){$(".refreshVideoList").css("display","block"),$(".pars_video_div").css("display","block")}),jQuery("body").on("click",".HelpDesk",function(e){$(".refreshVideoList").css("display","none"),$(".pars_video_div").css("display","none")}),jQuery("body").on("click",".About",function(e){$(".refreshVideoList").css("display","none"),$(".pars_video_div").css("display","none")})},ShowAdhanNotification:function(e,t,a,r){var n={title:'<i id="reminder-postpone-" title="'+e+'" class="cursorPointer fa fa-clock-o"></i> '+a+'  <span id="timer"></span>',message:"<div class='row'><div class='col-sm-12 col-md-12'><div class='caption'><a href='index.php?module=ParsVT&view=PrayTimes'><h3 style='background: #1cbc62;border-radius: 3px;padding:6px;text-align: center;font-size: 13px;'>"+e+" - "+t+"</h3></a></div></div><div class='col-sm-12 col-md-12'><center><audio id='adhan' controls autoplay  preload='auto'><source src='"+r+"' type='audio/mpeg'></audio></center></div>"};jQuery.notify(n,{delay:1e3,timer:4e5,element:"body",type:"danger"}),app.storage.set("Adhan",Math.round((new Date).getTime()/1e3));var i=new Date(Date());setInterval(function(){i.setSeconds(i.getSeconds()+1),$("#timer").text("-  "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds())},1e3),$("#adhan").length&&0==$("#adhan").get(0).paused&&$("#adhan").get(0).play()},consoleText:function(e,t,a){void 0===a&&(a=["#fff"]);var r=!0,n=document.getElementById("console"),i=1,s=1,o=!1,l=document.getElementById(t);l.setAttribute("style","color:"+a[0]),window.setInterval(function(){0===i&&!1===o?(o=!0,l.innerHTML=e[0].substring(0,i),window.setTimeout(function(){var t=a.shift();a.push(t);var r=e.shift();e.push(r),s=1,l.setAttribute("style","color:"+a[0]),i+=s,o=!1},1e3)):i===e[0].length+1&&!1===o?(o=!0,window.setTimeout(function(){i+=s=-1,o=!1},1e3)):!1===o&&(l.innerHTML=e[0].substring(0,i),i+=s)},60),window.setInterval(function(){!0===r?(n.className="console-underscore hidden",r=!1):(n.className="console-underscore",r=!0)},200)},initLayoutEditor:function(){var e=jQuery("#layoutEditorContainer");app.request.get({url:"index.php?module=ParsVT&action=ActionAjax&mode=LayoutEditorNotification"}).then(function(e,t){null===e&&$("#detailViewLayout div:eq(0)").before(t)}),jQuery(".editFields",e).on("dblclick",function(e){e.stopPropagation();var t="index.php?module=ParsVT&parent=Settings&view=LayoutEditor&fieldid="+jQuery(this).data("field-id");app.request.get({url:t}).then(function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})})}),jQuery(".editFieldsTable",e).on("dblclick",function(e){e.stopPropagation();var t="index.php?module=ParsVT&parent=Settings&view=LayoutEditor&blockid="+jQuery(this).data("block-id");app.request.get({url:t}).then(function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})})})},registerTranslate:function(){jQuery(document).on("click",".modalTranslateSaveButton",function(){var e=jQuery("#langVariable"),t=jQuery("#langTranslation");if(0==e.val().length)$(".langVariableVal")[0]?e.focus():(e.after('<span class="langVariableVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),e.focus());else if($(".langVariableVal").remove(),0==t.val().length)$(".langTranslationVal")[0]?t.focus():(t.after('<span class="langTranslationVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),t.focus());else{$(".langTranslationVal").remove();var a=jQuery("#newTranslateForm").serializeFormData(),r=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),n={};n.module="ParsVT",n.action="ActionAjax",n.mode="SaveLayoutEditor",n.data=a,AppConnector.request(n).then(function(e){r.progressIndicator({mode:"hide"}),e.success?1==e.result.success?app.helper.showSuccessNotification({message:e.result.message}):app.helper.showErrorNotification({message:e.result.message}):app.helper.showErrorNotification({message:"Error"})},function(e){r.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:"Error"})}),app.helper.hideModal(),setTimeout(function(){window.location.reload(1)},3e3)}})},registerLayoutEditor:function(){var e=this;if("LayoutEditor"==app.getModuleName()&&"Settings"==app.getParentModuleName()&&jQuery("#layoutEditorContainer").length>0){e.initLayoutEditor(),e.registerTranslate();jQuery("#layoutEditorContainer").on("change",'[name="layoutEditorModules"]',function(t){setInterval(function(){0==jQuery(".translateNotification").length&&(e.initLayoutEditor(),e.registerTranslate())},2e3)})}},removeToolbar:function(){$(document).on("click","#CloseLicenseToolbar",function(){jQuery("#LicenseToolbar").fadeOut("slow",function(){app.storage.set("ParsVT_Toolbar",Math.round((new Date).getTime()/1e3))}),$("#page").css("padding-top",84)})},ConvertTimeformat:function(e){format="24";var t=Number(e.match(/^(\d+)/)[1]),a=Number(e.match(/:(\d+)/)[1]),r=e.match(/\s(.*)$/);if(void 0===typeof r||null===r)return e;"PM"==(r=r[1])&&t<12&&(t+=12),"AM"==r&&12==t&&(t-=12);var n=t.toString(),i=a.toString();return t<10&&(n="0"+n),a<10&&(i="0"+i),n+":"+i},registerValidators:function(){var e=this,t=app.getDateFormat();if(void 0===(a=jQuery("body").data("calendar")))var a="undefined";var i="en";"jalali"==a?i="fa":"islamic"==a&&(i="ar");jQuery("body").data("language");"en"!=i&&(jQuery.validator.addMethod("date",function(e,a,r){return!(""!=e&&e&&0!==e.length&&!/^\s*$/.test(e))||(e=vtfarsitools.getDateInstance(e,t),this.optional(a)||/^([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))$/.test(e))},jQuery.validator.format(app.vtranslate("Please enter the correct date"))),jQuery.validator.addMethod("Calendar_greaterThanDependentField",function(t,a,r){var n=!0,s=jQuery(a).closest("form"),o=s.find('[name="date_start"]'),l=s.find('[name="time_start"]'),d=s.find('[name="due_date"]'),p=s.find('[name="time_end"]'),u=app.getDateFormat(),c=app.getHourFormat(),v="HH:mm";12===c&&(v="hh:mm A");var g=o.val(),f=d.val(),h="00:00",m="23:59";if(12===c&&(h="12:00 AM",m="11:59 PM"),l.length&&(h=l.val()),p.length&&(m=p.val()),"en"!=i){g=vtfarsitools.getDateInstance(g,u),f=vtfarsitools.getDateInstance(f,u);var b=g+" "+e.ConvertTimeformat(h),y=f+" "+e.ConvertTimeformat(m);n=(b=new Date(b))<=(y=new Date(y))}else{var _=u.toUpperCase()+" "+v,b=moment(g+" "+h,_),y=moment(f+" "+m,_);n=b.unix()<y.unix()}return n},jQuery.validator.format(app.vtranslate("JS_CHECK_START_AND_END_DATE_SHOULD_BE_GREATER"))),jQuery.validator.addMethod("lessThanDependentField",function(e,t,a){var r=!0;if(!e.length)return r;var n=this.settings.validationMeta;if(void 0!==n)s=n;else if("undefined"!=typeof uimeta)s=uimeta;else var s=quickcreate_uimeta;var o=jQuery(t),l=s.field.get(o.attr("name")),d=a[0],p=s.field.get(d);if(void 0===l||void 0===p)return r;if("date"!==l.type||"date"!==p.type)return r;var u=o.closest("form.recordEditView").first(),c=app.getDateFormat();if(u.length>0)v=u.find('[name="'+d+'"]').val();else{var v;app.controller();if(v=jQuery(".fieldBasicData").filter('[data-name="'+d+'"]').data("displayvalue")){4==v.split("-")[0].length&&(c="yyyy-mm-dd")}}if(void 0===v||""==v)return r;var g=app.getDateFormat();if("en"!=i){r=(f=e=vtfarsitools.getDateInstance(e,g,!0))<=(h=v=vtfarsitools.getDateInstance(v,g,!0))}else{var f=moment(e,g.toUpperCase()),h=moment(v,c.toUpperCase());r=f.unix()<=h.unix()}return jQuery.validator.messages.lessThanDependentField=l.label+" "+app.vtranslate("JS_SHOULD_BE_LESS_THAN_OR_EQUAL_TO")+" "+p.label,r},jQuery.validator.format(app.vtranslate("Please enter the correct date"))),jQuery.validator.addMethod("greaterThanDependentField",function(e,t,a){var r=!0;if(!e.length)return r;var n=this.settings.validationMeta;if(void 0!==n)s=n;else if("undefined"!=typeof uimeta)s=uimeta;else var s=quickcreate_uimeta;var o=jQuery(t),l=s.field.get(o.attr("name")),d=a[0],p=s.field.get(d);if(void 0===l||void 0===p)return r;if(!("date"===l.type&&"date"===p.type||"datetime"===l.type&&"datetime"===p.type))return console.log("greaterThanDependentField() validation method should be used for date fields only"),r;if(o.closest("form.recordEditView").length>0)u=o.closest("form.recordEditView").first();else var u=o.closest("form#detailView");if(u.length>0){if(void 0===(c=u.find('[name="'+d+'"]').val())){app.controller();c=jQuery(".fieldBasicData").filter('[data-name="'+d+'"]').data("displayvalue")}}else var c=app.controller().getFieldValue(d,o);if(void 0===c)return r;if(c.trim().length<=0)return!0;var v=app.getDateFormat();if("en"!=i){r=(g=e=vtfarsitools.getDateInstance(e,v,!0))>=(f=c=vtfarsitools.getDateInstance(c,v,!0))}else{var g=moment(e,v.toUpperCase()),f=moment(c,depFieldDateFormat.toUpperCase());r=g.unix()>=f.unix()}return jQuery.validator.messages.greaterThanDependentField=l.label+" "+app.vtranslate("JS_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO")+" "+p.label,r},jQuery.validator.format(app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE"))),jQuery.validator.addMethod("lessThanToday",function(e,a,r){try{if(e){if("en"!=i)(n=vtfarsitools.getDateInstance(e,t,!0)).setHours(0,0,0,0);else{var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0)}var s=new Date;s.setHours(0,0,0,0);if(s-n<=0)return!1}return!0}catch(e){return!1}},function(e,t){return app.vtranslate("JS_SHOULD_BE_LESS_THAN_CURRENT_DATE")}),jQuery.validator.addMethod("lessThanOrEqualToToday",function(e,a,r){try{if(e){"en"!=i&&(e=vtfarsitools.getDateInstance(e,t));var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0);var s=new Date;s.setHours(0,0,0,0);if(s-n<0)return!1}return!0}catch(e){return!1}},function(e,t){return app.vtranslate("JS_SHOULD_BE_LESS_THAN_OR_EQUAL_TO")+" "+app.vtranslate("JS_CURRENT_DATE")}),jQuery.validator.addMethod("greaterThanOrEqualToToday",function(e,a,r){try{if(e){"en"!=i&&(e=vtfarsitools.getDateInstance(e,t));var n=app.helper.getDateInstance(e,app.getDateFormat());n.setHours(0,0,0,0);var s=new Date;s.setHours(0,0,0,0);if(n-s<0)return!1}return!0}catch(e){return!1}},function(e,t){return app.vtranslate("JS_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO")+" "+app.vtranslate("JS_CURRENT_DATE")}),jQuery.validator.addMethod("futureEventCannotBeHeld",function(t,a,r){try{if("Held"==t)for(var n=jQuery(a).closest("form"),s=0;s<r.length;s++){var o=r[s],l=jQuery("input[name="+o+"]",n);if(l.length>0){var d=new Date,p=l.data("date-format"),u=jQuery("input[name=time_start]",n),c=l.val()+" "+u.val(),v=app.helper.getDateInstance(c,p);if("en"!=i){var p=app.getDateFormat(),c=l.val();t=(t=vtfarsitools.getDateInstance(c,p))+" "+e.ConvertTimeformat(u.val());var g=new Date(t),f=d;return result=g<=f,result}if(d-v<0)return!1}}return!0}catch(e){return console.log(e),!1}},jQuery.validator.format(app.vtranslate("JS_FUTURE_EVENT_CANNOT_BE_HELD"))),jQuery.validator.addMethod("greaterThanDependentRepeatTillDate",function(e,t,a){var r=jQuery(t).closest("form");if(!r.find('input[name="recurringcheck"]').is(":checked")||!jQuery(t).hasClass("dateField"))return!0;var n=r.find('[name="date_start"]'),s=r.find('[name="calendar_repeat_limit_date"]'),o=app.getDateFormat(),l=n.val(),d=s.val(),p=o.toUpperCase();if("en"!=i){e=vtfarsitools.getDateInstance(l,o,!0),depFieldVal=vtfarsitools.getDateInstance(d,o,!0);u=e;return(c=depFieldVal)>=u}var u=moment(l,p),c=moment(d,p);return c.unix()>=u.unix()},jQuery.validator.format(app.vtranslate("JS_REPEAT_DATE_SHOULD_BE_GREATER_THAN_START_DATE")))),jQuery.validator.addMethod("nationalcode",function(e,t){c=parseInt(e.charAt(9)),n=10*parseInt(e.charAt(0))+9*parseInt(e.charAt(1))+8*parseInt(e.charAt(2))+7*parseInt(e.charAt(3))+6*parseInt(e.charAt(4))+5*parseInt(e.charAt(5))+4*parseInt(e.charAt(6))+3*parseInt(e.charAt(7))+2*parseInt(e.charAt(8)),r=n-11*parseInt(n/11);var a=!0;return"10"!=e.length&&(a=!1),"1111111111"!=e&&"0000000000"!=e&&"2222222222"!=e&&"3333333333"!=e&&"4444444444"!=e&&"5555555555"!=e&&"6666666666"!=e&&"7777777777"!=e&&"8888888888"!=e&&"9999999999"!=e||(a=!1),this.optional(t)||a&&(0==r&&r==c||1==r&&1==c||r>1&&c==11-r)},app.vtranslate("Please enter a valid Iranian National ID Number")),jQuery.validator.addMethod("legalnationalcode",function(e,t){var a=!0;if((e.length<11||0==parseInt(e,10))&&(a=!1),0==parseInt(e.substr(3,6),10)&&(a=!1),a){for(var r=parseInt(e.substr(10,1),10),n=parseInt(e.substr(9,1),10)+2,i=new Array(29,27,23,19,17),s=0,o=0;o<10;o++)s+=(n+parseInt(e.substr(o,1),10))*i[o%5];10==(s%=11)&&(s=0),a=r==s}return this.optional(t)||a},app.vtranslate("Please enter a valid Iranian Legal National Code Number")),jQuery.validator.addMethod("iranianmobile",function(e,t){return this.optional(t)||/^(\+98|0)?9\d{9}$/.test(e)},app.vtranslate("Please enter a valid Iranian Mobile Number")+"\n (+989123456789 / 09123456789)"),jQuery.validator.addMethod("pwd",function(e,t){return this.optional(t)||/[0-9a-zA-Z*#+\s\w-~]*$/.test(e)},app.vtranslate("Please enter a valid password")),jQuery.validator.addMethod("ParsVTDate",function(e,t){return this.optional(t)||/^([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))/.test(e)},app.vtranslate("JS_PLEASE_ENTER_VALID_DATE")),jQuery.validator.addMethod("IBAN",function(t,a){return this.optional(a)||e.validateISO7064Checksum(t)},app.vtranslate("Please Enter Valid IBAN Code")),jQuery.validator.addMethod("CCN",function(e,t){var a=[{rule:/^603799\d{10}/g},{rule:/^589210\d{10}/g},{rule:/^627648\d{10}/g},{rule:/^627961\d{10}/g},{rule:/^603770\d{10}/g},{rule:/^628023\d{10}/g},{rule:/^628023\d{10}/g},{rule:/^502908\d{10}/g},{rule:/^627412\d{10}/g},{rule:/^622106\d{10}/g},{rule:/^639347\d{10}/g},{rule:/^502229\d{10}/g},{rule:/^627488\d{10}/g},{rule:/^621986\d{10}/g},{rule:/^639346\d{10}/g},{rule:/^639607\d{10}/g},{rule:/^636214\d{10}/g},{rule:/^502806\d{10}/g},{rule:/^502938\d{10}/g},{rule:/^603769\d{10}/g},{rule:/^610433\d{10}/g},{rule:/^627353\d{10}/g},{rule:/^589463\d{10}/g},{rule:/^627381\d{10}/g},{rule:/^504172\d{10}/g},{rule:/^636949\d{10}/g},{rule:/^505416\d{10}/g},{rule:/^606373\d{10}/g},{rule:/^628157\d{10}/g},{rule:/^639599\d{10}/g},{rule:/^585983\d{10}/g},{rule:/^505785\d{10}/g}];if(this.optional(t)||/^\d{4}-?\d{4}-?\d{4}-?\d{4}$/.test(e)){ccnvalue=e.replace(/[^0-9.]/g,"");for(var r=0;r<a.length;r++)if(a[r].rule.test(ccnvalue))return ParsVTCustomFields_Js.CheckCardDigits(ccnvalue);return!0}return!1},app.vtranslate("Please Enter Valid Credit Card Number")),jQuery.validator.addMethod("irpostalcode",function(e,t){return this.optional(t)||/^(?!(\d)\1{3})[13-9]{4}[1346-9][0-9]{5}$/.test(e)},app.vtranslate("Please Enter Valid Postal Code")),jQuery.validator.addMethod("iranvatid",function(e,t){var a=!1;if(a=!1,11==e.length){if(a=!0,(e.length<11||0==parseInt(e,10))&&(a=!1),0==parseInt(e.substr(3,6),10)&&(a=!1),a){for(var r=parseInt(e.substr(10,1),10),n=parseInt(e.substr(9,1),10)+2,i=new Array(29,27,23,19,17),s=0,o=0;o<10;o++)s+=(n+parseInt(e.substr(o,1),10))*i[o%5];10==(s%=11)&&(s=0),a=r==s}}else if(e.indexOf("0")>-1||e.indexOf("2")>-1)a=!1;else if(12==e.length){a=[11,15,18,33,36,39,44,47,51,55,58,63,66,69,74,77,81,85,88,93,96,99,13,16,19,34,37,41,45,48,53,56,59,64,67,71,75,78,83,86,89,94,97,14,17,31,35,43,49,54,57,65,68,73,76,79,84,87,91,95,98][Math.round(11*parseFloat(e.substr(0,1))+13*parseFloat(e.substr(1,1))+17*parseFloat(e.substr(2,1))+19*parseFloat(e.substr(3,1))+23*parseFloat(e.substr(4,1))+29*parseFloat(e.substr(5,1))+31*parseFloat(e.substr(6,1))+37*parseFloat(e.substr(7,1))+41*parseFloat(e.substr(8,1))+43*parseFloat(e.substr(9,1)))%61|0]==parseFloat(e.substr(10,2))}return this.optional(t)||a},app.vtranslate("Please Enter Valid VAT ID")),jQuery.validator.addMethod("taxfilenumber",function(e,t){var a=!1;if(12!==e.length)a=!1;else{a=Math.round(13*parseFloat(e.substr(0,1))+11*parseFloat(e.substr(2,1))+9*parseFloat(e.substr(3,1))+6*parseFloat(e.substr(4,1))+7*parseFloat(e.substr(5,1))+6*parseFloat(e.substr(6,1))+5*parseFloat(e.substr(7,1))+9*parseFloat(e.substr(8,1))+3*parseFloat(e.substr(9,1))+2*parseFloat(e.substr(10,1)))%11==parseFloat(e.substr(11,1))}return this.optional(t)||a},app.vtranslate("Please Enter Valid Tax File Number")),jQuery.validator.addMethod("barcode",function(e,t){return this.optional(t)||/^([a-zA-Z0-9_\-\.]+)$/.test(e)},app.vtranslate("Please Enter Valid Barcode Number"))},responsiveMode:function(){document.body.clientWidth<800&&($("div#MARKETING_modules_dropdownMenu").attr("data-default-url",""),$("div#SALES_modules_dropdownMenu").attr("data-default-url",""),$("div#INVENTORY_modules_dropdownMenu").attr("data-default-url",""),$("div#SUPPORT_modules_dropdownMenu").attr("data-default-url",""),$("div#PROJECT_modules_dropdownMenu").attr("data-default-url",""),$("div#TOOLS_modules_dropdownMenu").attr("data-default-url",""),$(".app-modules-dropdown-container .dropdown-backdrop").css("display","none")),$(document).ready(function(){$(window).resize(function(){$("#page").css("padding-top",$("#page>nav").height()+"px")}),setTimeout(function(){$("#page").css("padding-top",$("#page>nav").height()+"px")},1e3)})},validateISO7064Checksum:function(e){var t=function(e){var t=parseInt(e,10)%97;return 1===(t=t.toString()).length?"0"+t:t};if(e){for(e=function(e){for(var t=e.split(""),a=0;a<t.length;a++)/[A-Z]/.test(t[a])&&(t[a]=t[a].charCodeAt(0)-55);return t.join("")}(e=e.substr(4)+e.substr(0,4));e.length>2&&!isNaN(e);)e=t(e.substr(0,9))+e.substr(9);if(1===parseInt(e,10))return!0}return!1},initialization:function(){var e=this,t=app.storage.get("ParsVTMode"),a=app.storage.get("ParsVTTime"),r=Math.round((new Date).getTime()/1e3);if(null===t||null===a||1!=t.length||r>a+3600){var n={};n.action="ActionAjax",n.module="ParsVT",n.mode="initialization",app.request.post({data:n}).then(function(t,a){if(null==t)if(a&&a.result)a.t&&"B"!=a.t&&(e.registerSettingsBtn(),e.responsiveMode(),e.SwitchDirection(),e.FormatInventoryNumbers(),e.registerStartParsVT()),a.t&&"F"==a.t?(e.checkPermissionForAdhan(),e.registerLayoutEditor(),e.registerValidators(),app.storage.set("ParsVTMode","F")):a.t&&"C"==a.t?(e.registerValidators(),e.checkPermissionForAdhan(),app.storage.set("ParsVTMode","C")):app.storage.set("ParsVTMode","B"),app.storage.set("ParsVTTime",Math.round((new Date).getTime()/1e3));else if(a&&a.errors&&a.links)if(a.rlink[0])if("Settings"==app.getParentModuleName()){var r=app.storage.get("ParsVT_Toolbar"),n=Math.round((new Date).getTime()/1e3);(null===r||n>r+600)&&e.registerTopMenu(a.errors,a.links)}else app.helper.showProgress(),window.location=a.rlink[1];else app.helper.showProgress(),window.location=a.rlink[1]},function(e,t){})}else"B"!=t&&(e.registerSettingsBtn(),e.responsiveMode(),e.SwitchDirection(),e.FormatInventoryNumbers(),e.registerStartParsVT()),"F"==t?(e.checkPermissionForAdhan(),e.registerLayoutEditor(),e.registerValidators()):"C"==t&&(e.registerValidators(),e.checkPermissionForAdhan())},isUnicode:function(e){for(var t=0,a=e.length;t<a;t++)if(e.charCodeAt(t)>255)return!0;return!1},SwitchDirection:function(){var e=this;$("body").on("keyup","input[type=text],textarea",function(t){e.isUnicode(t.currentTarget.value)?($(t.currentTarget).css("direction","rtl"),$(t.currentTarget).css("text-align","right")):($(t.currentTarget).css("direction","ltr"),$(t.currentTarget).css("text-align","left"))})},FormatInventoryNumbers:function(){var e=this;"Invoice"!=app.getModuleName()&&"Quotes"!=app.getModuleName()&&"SalesOrder"!=app.getModuleName()&&"PurchaseOrder"!=app.getModuleName()||"Edit"!=app.view()||$(function(){$(document).on("change keyup",".qty",function(){var t=e.addCommas($(this).val());0==$(this).parent().find("span.qty_separator").length?$(this).after('<br><span style="color: #959595;" class="qty_separator">'+t+"</span>"):$(this).parent().find("span.qty_separator").html(t)}),$(document).on("change keyup",".listPrice",function(){var t=e.addCommas($(this).val());0==$(this).parent().parent().find("span.listPrice_separator").length?$(this).parent().after('<br><span style="color: #959595;" class="listPrice_separator">'+t+"</span>"):$(this).parent().parent().find("span.listPrice_separator").html(t)})})},addCommas:function(e){for(var t=(e+="").split("."),a=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(a);)a=a.replace(n,"$1,$2");return a+r},showInventorySave:function(){if(InventoryModulesNames.includes(app.getModuleName())){$(".saveButton").removeClass("hide");var e=0,t=setInterval(function(){20!==(e+=1)&&$(".saveButton").hasClass("hide")||clearInterval(t),$(".saveButton").removeClass("hide")},2e3);$("#EditView .saveButton").click(function(){jQuery("#EditView").valid()&&0===jQuery("#EditView").validate().pendingRequest&&jQuery(".saveButton").addClass("hide")})}},registerEvents:function(){this.removeToolbar(),this.initialization(),this.showInventorySave()}};jQuery(document).ready(function(){Vtiger_ParsVT_Js.registerEvents()});