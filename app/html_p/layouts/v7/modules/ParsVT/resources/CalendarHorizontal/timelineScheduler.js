/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
var TimeScheduler={Options:{GetSections:function(e){},GetSchedule:function(e,t,a){},Start:moment.utc(),HeaderFormat:"YYYY-MM-DD",LowerFormat:"YYYY-MM-DD HH:mm",Periods:[{Name:"2 days",Label:"2 days",TimeDuration:30,StartPeroid:0,TimeframePeriod:120,TimeframeOverall:2880,TimeframeHeaders:["Do MMM","HH"]},{Name:"2 weeks",Label:"2 weeks",TimeframePeriod:1440,TimeframeOverall:20160,TimeframeHeaders:["MMM","Do"]}],SelectedPeriod:"2 weeks",Element:$("<div></div>"),MinRowHeight:40,ShowCurrentTime:!0,ShowGoto:!0,ShowToday:!0,Text:{NextButton:"Next",NextButtonTitle:"Next period",PrevButton:"Prev",PrevButtonTitle:"Previous period",NextDayButton:"Next Day",NextDayButtonTitle:"Next Day",PrevDayButton:"Prev Day",PrevDayButtonTitle:"Previous Day",TodayButton:app.vtranslate("Today"),TodayButtonTitle:"Go to today",GotoButton:app.vtranslate("Go to"),GotoButtonTitle:"Go to specific date"},Events:{ItemMouseEnter:null,ItemMouseLeave:null,ItemClicked:null,ItemDropped:null,ItemResized:null,ItemMovement:null,ItemMovementStart:null,ItemMovementEnd:null,ItemEventClick:null,ItemEventMouseEnter:null,ItemEventMouseLeave:null},AllowDragging:!1,AllowResizing:!1,DisableOnMove:!1,MaxHeight:null,showPopover:!1},Wrapper:null,HeaderWrap:null,TableWrap:null,HeaderTable:null,ContentWrap:null,GridTable:null,SectionWrap:null,Table:null,Sections:{},CachedSectionResult:null,CachedScheduleResult:null,Init:function(e){TimeScheduler.Options.Element.find(".ui-draggable").draggable("destroy"),TimeScheduler.Options.Element.empty(),TimeScheduler.Wrapper=$('<div class="time-sch-wrapper"></div>').appendTo(TimeScheduler.Options.Element),TimeScheduler.HeaderWrap=$('<div class="time-sch-header-wrapper"></div>').appendTo(TimeScheduler.Wrapper),TimeScheduler.TableWrap=$('<div class="time-sch-table-wrapper"></div>').appendTo(TimeScheduler.Wrapper),TimeScheduler.SectionWrap=$('<div class="time-sch-section-wrapper"></div>').appendTo(TimeScheduler.TableWrap),TimeScheduler.CreateCalendar(),TimeScheduler.FillSections(e)},GetSelectedPeriod:function(){for(var e,t=0;t<TimeScheduler.Options.Periods.length;t++)if(TimeScheduler.Options.Periods[t].Name===TimeScheduler.Options.SelectedPeriod){e=TimeScheduler.Options.Periods[t];break}return e||(e=TimeScheduler.Options.Periods[0],TimeScheduler.SelectPeriod(e.Name)),e},GetEndOfPeriod:function(e,t){parsvt_calendar_scheduler=1;var a=moment(e).add("minutes",t.TimeframeOverall,1);return parsvt_calendar_scheduler=0,a},CreateCalendar:function(){var e,t,a,i,r,n,s,d,l,o,c=null,m=0;"1 month"==(d=TimeScheduler.GetSelectedPeriod()).Name&&(d.TimeframeOverall=1440*TimeScheduler.Options.Start.daysInMonth());var u=d.Name.replace(" ","_");l=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,d),s=Math.abs(TimeScheduler.Options.Start.diff(l,"minutes"))/d.TimeframePeriod,TimeScheduler.Table=$('<table class="time-sch-table"></table>'),e=$("<thead></thead>"),t=$("<tbody></tbody>");for(var p=0;p<d.TimeframeHeaders.length;p++){c=null,m=0,n=d.TimeframeHeaders[p],a=$('<tr class="time-sch-times"></tr>').addClass("time-sch-times-header-"+p+" time-sch-times-header-"+p+"_"+u).appendTo(e),i="1 days"==d.Name?$('<td class="time-sch-section-header"></td>').append(r).appendTo(a):$('<td class="time-sch-section-header"></td>').appendTo(a);for(var h=0;h<s;h++){if(r=moment.utc(TimeScheduler.Options.Start).local().add("minutes",h*d.TimeframePeriod,1).format(n),c!==r){c&&(i.attr("colspan",m),m=0),c=r;var S=["Jan","Feb","Mrt","Apr","Mei","Jun","Jul","Aug","Sep","Okt","Nov","Des"];"undefined"!=typeof parsvtCalendar&&"gregorian"!=parsvtCalendar&&("jalali"==parsvt_calendar?o=[app.vtranslate("Farvardin"),app.vtranslate("Ordibehesht"),app.vtranslate("Khordad"),app.vtranslate("Tir"),app.vtranslate("Mordad"),app.vtranslate("Shahrivar"),app.vtranslate("Mehr"),app.vtranslate("Aban"),app.vtranslate("Azar"),app.vtranslate("Dey"),app.vtranslate("Bahman"),app.vtranslate("Esfand")]:"islamic"==parsvt_calendar&&(o=[app.vtranslate("Muharram"),app.vtranslate("Safar"),app.vtranslate("Rabi al-awwal"),app.vtranslate("Rabi al-thani"),app.vtranslate("Jumada al-awwal"),app.vtranslate("Jumada al-thani"),app.vtranslate("Rajab"),app.vtranslate("Shaaban"),app.vtranslate("Ramadan"),app.vtranslate("Shawwal"),app.vtranslate("Dhu al-Qidah"),app.vtranslate("Dhu al-Hijjah")]),-1!==S.indexOf(r)&&TimeScheduler.arraySearch(S,r)&&(r=o[TimeScheduler.arraySearch(S,r)])),i=$('<td class="time-sch-date-header"></td>').append(r).appendTo(a)}m+=1}i.attr("colspan",m)}TimeScheduler.Table.append(e,t),TimeScheduler.TableWrap.append(TimeScheduler.Table),TimeScheduler.FillHeader(),$(document).ready(function(){$(".time-sch-table").freezeHeader({offset:"84px",background_color:"#F5F5F5"})})},arraySearch:function(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return a;return!1},CreateSections:function(e){var t,a,i,r;t=1,r=$.makeArray(TimeScheduler.Table.find("thead tr"));for(n=0;n<r.length;n++)t<$(r[n]).find(".time-sch-date-header").length&&(t=$(r[n]).find(".time-sch-date-header").length);for(var n=0;n<e.length;n++){for((a=$('<tr class="time-sch-section-row"></tr>').css("height",TimeScheduler.Options.MinRowHeight)).addClass(n%2==0?"time-sch-section-even":"time-sch-section-odd"),$('<td class="time-sch-section textOverflowEllipsis"></td>').text(e[n].name).attr("title",e[n].name).data("section",e[n]).appendTo(a),time=0;time<t;time++)$('<td class="time-sch-date"></td>').appendTo(a);i=$('<div class="time-sch-section-container"></div>').css("height",TimeScheduler.Options.MinRowHeight).data("section",e[n]).click(TimeScheduler.Cell_Clicked).appendTo(TimeScheduler.SectionWrap),TimeScheduler.Sections[e[n].id]={row:a,container:i},TimeScheduler.Table.find("tbody").append(a)}TimeScheduler.SectionWrap.css({top:TimeScheduler.Table.find("thead").height(),left:$(".time-sch-section").outerWidth()}),TimeScheduler.Options.ShowCurrentTime&&TimeScheduler.ShowCurrentTime()},ShowCurrentTimeHandle:null,ShowCurrentTime:function(){var e,t,a,i;TimeScheduler.ShowCurrentTimeHandle&&clearTimeout(TimeScheduler.ShowCurrentTimeHandle);var r=0;"undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language||(r=TimeScheduler.GetSelectedPeriod().TimeframePeriod),e=moment(),i=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,TimeScheduler.GetSelectedPeriod()),t=Math.abs(TimeScheduler.Options.Start.diff(i,"minutes")),a=Math.abs(TimeScheduler.Options.Start.diff(e,"minutes"))+r,$(".time-sch-current-time").remove(),e>=TimeScheduler.Options.Start&&e<=i&&("undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language?$('<div class="time-sch-current-time"></div>').css("left",a/t*100+"%").attr("title",e.format(TimeScheduler.Options.LowerFormat)).appendTo(TimeScheduler.SectionWrap):$('<div class="time-sch-current-time"></div>').css("right",a/t*100+"%").attr("title",e.format(TimeScheduler.Options.LowerFormat)).appendTo(TimeScheduler.SectionWrap)),TimeScheduler.ShowCurrentTimeHandle=setTimeout(TimeScheduler.ShowCurrentTime,3e4)},CreateItems:function(e){var t,a,i,r,n,s,d,l,o,c,m,u,p,h,S,v,f,T,g,_,O,b,C={},y=$("#calendar_horizontal_title_font_size").val(),P=$("#calendar_horizontal_title_font_size_unit").val();O=TimeScheduler.GetSelectedPeriod(),b=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,O),o=Math.abs(TimeScheduler.Options.Start.diff(b,"minutes"));for(G=0;G<e.length;G++)if(t=e[G],i=TimeScheduler.Sections[t.sectionID]){C[t.sectionID]||(C[t.sectionID]=[]);var D={},w={},E={},k={};if(D=Object.assign({},TimeScheduler.Options.Start),w=Object.assign({},b),E=Object.assign({},t.start),k=Object.assign({},t.end),"undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&(("string"==typeof E._d||E._d instanceof String)&&(E._d=new Date(E._d)),("string"==typeof w._d||w._d instanceof String)&&(w._d=new Date(w._d)),("string"==typeof k._d||k._d instanceof String)&&(k._d=new Date(k._d)),("string"==typeof D._d||D._d instanceof String)&&(D._d=new Date(D._d))),E<=w&&k>=D){T=null,"undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale?(v=t.start>TimeScheduler.Options.Start?t.start:TimeScheduler.Options.Start,f=t.end<b?t.end:b):(parsvt_calendar_scheduler=1,v=moment(Math.max(t.start,TimeScheduler.Options.Start)),f=moment(Math.min(t.end,b)),parsvt_calendar_scheduler=0),c=v.diff(TimeScheduler.Options.Start,"minutes"),m=Math.abs(v.diff(f,"minutes")),p=1;var M=0;if("undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language||(M=O.TimeframePeriod),h=(c+M)/o*100,S=m/o*100,r=$('<div class="time-sch-item" style="background-color: '+t.color+"; color: "+t.textColor+'"></div>'),"undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language?r.css({top:p,left:h+"%",width:S+"%"}):r.css({top:p,right:h+"%",width:S+"%"}),l=$('<img alt="Icon" class="time-sch-item-icon" />'),s=$('<div class="time-sch-item-content"></div>'),t.name){if(d=$('<div class="time-sch-item-name"></div>'),""!=y){var I="px";"percent"==P&&(I="%"),d.css({"font-size":y+I})}d.html(t.name),s.append(d)}if(t.icon&&(l.attr({src:t.icon}),r.append(l)),r.append(s),t.classes&&r.addClass(t.classes),t.events)for(var N=0;N<t.events.length;N++)u=(a=t.events[N]).at.diff(v,"minutes")/m*100,n=$('<div class="time-sch-item-event"></div>').attr("title",a.at.format(TimeScheduler.Options.LowerFormat)+" - "+a.label).css("left",u+"%").data("event",a),a.classes&&n.addClass(a.classes),r.append(n);"undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language?(t.start>=TimeScheduler.Options.Start&&r.append('<div class="time-sch-item-start"></div>'),t.end<=b&&r.append('<div class="time-sch-item-end"></div>')):(t.start>=TimeScheduler.Options.Start&&r.append('<div class="time-sch-item-start" style="right: 1px;width: 1px;"></div>'),t.end<=b&&r.append('<div class="time-sch-item-end"  style="left: 1px;width: 1px;"></div>')),t.Element=r;for(var x=0;x<C[t.sectionID].length;x++)if(C[t.sectionID][x].start>t.start){T=x;break}null===T&&(T=C[t.sectionID].length),C[t.sectionID].splice(T,0,t),r.data("item",t),TimeScheduler.SetupItemEvents(r),i.container.append(r)}}for(var H in C){i=TimeScheduler.Sections[H];for(var G=0;G<C[H].length;G++){g=C[H][G];for(var F=0;F<G;F++){var R,B,W,L;L=(W=(_=C[H][F]).Element.position().top)+_.Element.outerHeight(),B=(R=g.Element.position().top)+g.Element.outerHeight(),(_.start<=g.start&&g.start<_.end||_.start<=g.end&&g.end<=_.end)&&(W<=R&&R<=L||W<=B&&B<=L)&&g.Element.css("top",L+1)}(B=g.Element.position().top+g.Element.outerHeight()+1)>i.container.height()&&(i.container.css("height",B),i.row.css("height",B))}}},registerPopoverEvent:function(e,t){var a=Calendar_Calendar_Js.getInstance(),i=a.getUserPrefered("date_format");i=i.toUpperCase();var r="HH:mm";"12"===a.getUserPrefered("time_format")&&(r="hh:mm a");var n=e.id.split("_"),s=function(e){var t="";"Task"===e.activitytype?(parsvt_calendar_scheduler=1,t=moment(e.start._i,e.start._f).format(r),parsvt_calendar_scheduler=0):"Events"===e.module?(e.start&&void 0!==e.start&&(t=e.start.format(r)),e.end&&void 0!==e.end&&(t+=" - "+e.end.format(r))):t=e.start.format(i);var a=e.module;a||(a="Calendar");var s="";return s+="<span>"+t+"</span>","Calendar"!==a&&"Events"!=a||(s+='<span class="pull-right cursorPointer" onClick="CalendarHorizontal.deleteCalendarEvent(\''+n[1]+"','"+a+'\');" title="'+app.vtranslate("JS_DELETE")+'">&nbsp;&nbsp;<i class="fa fa-trash"></i></span> &nbsp;&nbsp;',"Events"===a?s+='<span class="pull-right cursorPointer" onClick="CalendarHorizontal.editCalendarEvent('+n[1]+');" title="'+app.vtranslate("JS_EDIT")+'">&nbsp;&nbsp;<i class="fa fa-pencil"></i></span>':"Calendar"===a&&(s+='<span class="pull-right cursorPointer" onClick="CalendarHorizontal.editCalendarEvent('+n[1]+');" title="'+app.vtranslate("JS_EDIT")+'">&nbsp;&nbsp;<i class="fa fa-pencil"></i></span>'),"Held"!==e.status&&"Completed"!==e.status?s+='<span class="pull-right cursorPointer"onClick="CalendarHorizontal.markAsHeld(\''+n[1]+'\');" title="'+app.vtranslate("JS_MARK_AS_HELD")+'"><i class="fa fa-check"></i></span>':"Held"===e.status&&(s+='<span class="pull-right cursorPointer" onClick="CalendarHorizontal.holdFollowUp(\''+n[1]+'\');" title="'+app.vtranslate("JS_CREATE_FOLLOW_UP")+'"><i class="fa fa-flag"></i></span>')),s},d="",l="";$(t).find(".time-sch-item-name").find(".fc-horizontal-time").length?(d+=s(e),l=e.title):(d+=$(t).find(".time-sch-item-name").html()+"<hr />"+s(e),l=e.title);var o={title:l,content:d,trigger:"hover",closeable:!0,placement:"top",animation:"fade"};t.webuiPopover(o)},SetupItemEvents:function(e){var t=e.data("item"),a=TimeScheduler.GetSelectedPeriod();TimeScheduler.SectionWrap.width(),a.TimeDuration,a.TimeframeOverall,$(".time-sch-section-container").height();TimeScheduler.Options.showPopover&&TimeScheduler.registerPopoverEvent(t,e),TimeScheduler.Options.Events.ItemClicked&&e.find(".time-sch-item-content").click(function(t){t.preventDefault();var a=$(t.target);a.is("a")?window.open(a.attr("href"),"_blank"):TimeScheduler.Options.Events.ItemClicked.call(this,e.data("item")),t.stopPropagation()}),TimeScheduler.Options.Events.ItemMouseEnter&&e.mouseenter(function(e){TimeScheduler.Options.Events.ItemMouseEnter.call(this,$(this).data("item"))}),TimeScheduler.Options.Events.ItemMouseLeave&&e.mouseleave(function(e){TimeScheduler.Options.Events.ItemMouseLeave.call(this,$(this).data("item"))});TimeScheduler.Options.Events.ItemEventClick&&e.find(".time-sch-item-event").click(function(e){e.preventDefault();var t=$(this).closest(".time-sch-item");e.preventDefault(),TimeScheduler.Options.Events.ItemEventClick.call(this,$(this).data("event"),t.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseEnter&&e.find(".time-sch-item-event").mouseenter(function(e){var t=$(this).closest(".time-sch-item");e.preventDefault(),TimeScheduler.Options.Events.ItemEventMouseEnter.call(this,$(this).data("event"),t.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseLeave&&e.find(".time-sch-item-event").mouseleave(function(e){var t=$(this).closest(".time-sch-item");e.preventDefault(),TimeScheduler.Options.Events.ItemEventMouseLeave.call(this,$(this).data("event"),t.data("item"))})},roundTimeWithDuration:function(e){var t=TimeScheduler.GetSelectedPeriod(),a=t.TimeDuration,i=t.TimeframePeriod/a,r=e.format("mm"),n=r;if(r%a!=0){if(r>=a){for(var s=1;s<=i;s++)if(r<a*s){r=TimeScheduler.roundCustom(r,a*(s-1),a*s);break}}else r=TimeScheduler.roundCustom(r,0,a);return e=e.add("minutes",r).subtract("minute",n,1)}return e},roundCustom:function(e,t,a){return e=e<=(t+a)/2?t:a},FillSections:function(e){!TimeScheduler.CachedSectionResult||e?TimeScheduler.Options.GetSections.call(this,TimeScheduler.FillSections_Callback):TimeScheduler.FillSections_Callback(TimeScheduler.CachedSectionResult)},FillSections_Callback:function(e){TimeScheduler.CachedSectionResult=e,TimeScheduler.CreateSections(e),TimeScheduler.FillSchedule()},FillSchedule:function(){var e,t;e=TimeScheduler.GetSelectedPeriod(),t=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,e),TimeScheduler.Options.GetSchedule.call(this,TimeScheduler.FillSchedule_Callback,TimeScheduler.Options.Start,t)},FillSchedule_Callback:function(e){TimeScheduler.CachedScheduleResult=e,TimeScheduler.CreateItems(e)},FillHeader:function(){var e,t,a,i,r,n;t=$('<div class="time-sch-period-container"></div>'),a=$('<div class="time-sch-time-container"></div>'),e=$('<div class="time-sch-title"></div>'),i=TimeScheduler.GetSelectedPeriod(),r=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,i),e.text(TimeScheduler.Options.Start.format(TimeScheduler.Options.HeaderFormat)+" - "+r.format(TimeScheduler.Options.HeaderFormat));for(var s=0;s<TimeScheduler.Options.Periods.length;s++)"Custom"!=(n=TimeScheduler.Options.Periods[s]).Label?$('<a class="time-sch-period-button time-sch-button" href="#"></a>').text(app.vtranslate(n.Label)).addClass(n.Name===i.Name?"time-sch-selected-button":"").data("period",n).click(TimeScheduler.Period_Clicked).appendTo(t):n.Name===i.Name?($('<a class="time-sch-period-button time-sch-button dateRange dateField" data-calendar-type="range" data-filtermode="range" value="" href="#"><i class="fa fa-calendar"></i></a><button type="button" class="time-sch-period-button time-sch-button rangeDisplay"><span class="selectedRange" data="'+n.DateRangeValue+'">'+n.DateRange+"</span></button>").addClass("time-sch-selected-button").data("period",n).appendTo(t),TimeScheduler.registerCustomDateFilter(t)):($('<a class="time-sch-period-button time-sch-button dateRange dateField" data-calendar-type="range" data-filtermode="range" value="" href="#"><i class="fa fa-calendar"></i></a><button type="button" class="time-sch-period-button time-sch-button hide rangeDisplay"><span class="selectedRange"></span></button>').addClass("").data("period",n).appendTo(t),TimeScheduler.registerCustomDateFilter(t));TimeScheduler.Options.ShowGoto&&$('<a class="time-sch-time-button time-sch-time-button-goto time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.GotoButton).addClass("1 days"==i.Name?"":"hide").attr("title",TimeScheduler.Options.Text.GotoButtonTitle).click(TimeScheduler.GotoTimeShift_Clicked).appendTo(a),TimeScheduler.Options.ShowToday&&$('<a class="time-sch-time-button time-sch-time-button-today time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.TodayButton).addClass("1 days"==i.Name?"":"hide").attr("title",TimeScheduler.Options.Text.TodayButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(a),$('<a class="time-sch-time-button time-sch-time-button-prev time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.PrevButton).addClass("Custom"==i.Name?"hide":"").attr("title",TimeScheduler.Options.Text.PrevButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(a),$('<a class="time-sch-time-button time-sch-time-button-prev-day time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.PrevDayButton).addClass("Custom"==i.Name?"hide":"").attr("title",TimeScheduler.Options.Text.PrevDayButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(a),$('<a class="time-sch-time-button time-sch-time-button-next-day time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.NextDayButton).addClass("Custom"==i.Name?"hide":"").attr("title",TimeScheduler.Options.Text.NextDayButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(a),$('<a class="time-sch-time-button time-sch-time-button-next time-sch-button" href="#"></a>').append(TimeScheduler.Options.Text.NextButton).addClass("Custom"==i.Name?"hide":"").attr("title",TimeScheduler.Options.Text.NextButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(a),$(".time-sch-period-container-top").length>0?($(".time-sch-period-container-top").empty().append(t),TimeScheduler.HeaderWrap.append(a,e)):TimeScheduler.HeaderWrap.append(t,a,e),a.css("direction","ltr")},GotoTimeShift_Clicked:function(e){e.preventDefault();var t;t=TimeScheduler.GetSelectedPeriod();var a=(new Date).getTime(),i=$('<input type="text" id="go_to_date_'+a+'" />').css({position:"absolute",left:0,bottom:0}).appendTo($(this)).datepicker({autoclose:!0,onClose:function(){$(this).remove()},onSelect:function(e){var a=e;if("undefined"!=typeof parsvt_interface_language&&("fa"===parsvt_interface_language||"ar"===parsvt_interface_language)){var i=a.getMonth()+1;i=i<10?"0"+i:i;var r=a.getDate();r=r<10?"0"+r:r,a=a.getFullYear()+"-"+i+"-"+r}parsvt_calendar_scheduler=1,TimeScheduler.Options.Start=moment(a).add("minutes",60*t.StartPeroid,1),TimeScheduler.Init(),parsvt_calendar_scheduler=0},defaultDate:TimeScheduler.Options.Start.format("YYYY-MM-DD")}).on("changeDate",function(e){var a=e.date;if("undefined"!=typeof parsvt_interface_language&&("fa"===parsvt_interface_language||"ar"===parsvt_interface_language)){var i=a.getMonth()+1;i=i<10?"0"+i:i;var r=a.getDate();r=r<10?"0"+r:r,a=a.getFullYear()+"-"+i+"-"+r}parsvt_calendar_scheduler=1,TimeScheduler.Options.Start=moment(a).add("minutes",60*t.StartPeroid,1),TimeScheduler.Init(),parsvt_calendar_scheduler=0});i.datepicker("show"),i.hide()},TimeShift_Clicked:function(e){var t;e.preventDefault(),t=TimeScheduler.GetSelectedPeriod();var a=TimeScheduler.Options.Start;$(this).is(".time-sch-time-button-today")?TimeScheduler.Options.Start=moment().startOf("day",1).add("minutes",60*t.StartPeroid,1):$(this).is(".time-sch-time-button-prev-day")?"1 week"==t.Name?TimeScheduler.Options.Start.subtract("days",1,1).add("Milliseconds",1,1):"1 month"==t.Name?TimeScheduler.Options.Start.subtract("days",1,1).add("Milliseconds",1,1):"1 days"==t.Name&&(TimeScheduler.Options.Start.subtract("days",1,1),TimeScheduler.Options.Start.startOf("day",1).add("minutes",60*t.StartPeroid,1)):$(this).is(".time-sch-time-button-next-day")?"1 week"==t.Name?TimeScheduler.Options.Start.add("days",1,1).add("Milliseconds",1,1):"1 month"==t.Name?TimeScheduler.Options.Start.add("days",1,1).add("Milliseconds",1,1):"1 days"==t.Name&&(TimeScheduler.Options.Start.add("days",1,1),TimeScheduler.Options.Start.startOf("day",1).add("minutes",60*t.StartPeroid,1)):$(this).is(".time-sch-time-button-prev")?"1 week"==t.Name?("undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&a.add("days",1,1).add("Milliseconds",1,1),TimeScheduler.Options.Start=a.startOf("week",1).add("Milliseconds",1,1),TimeScheduler.Options.Start.subtract("weeks",1,1),"undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&TimeScheduler.Options.Start.subtract("days",1,1).add("Milliseconds",1,1)):"1 month"==t.Name?(TimeScheduler.Options.Start=a.startOf("month",1).add("Milliseconds",1,1),TimeScheduler.Options.Start.subtract("months",1,1).add("Milliseconds",1,1)):"1 days"==t.Name&&(TimeScheduler.Options.Start.subtract("days",1,1),TimeScheduler.Options.Start.startOf("day",1).add("minutes",60*t.StartPeroid,1,1)):$(this).is(".time-sch-time-button-next")&&("1 week"==t.Name?("undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&a.add("days",1,1).add("Milliseconds",1,1),TimeScheduler.Options.Start=a.startOf("week",1).add("Milliseconds",1,1),TimeScheduler.Options.Start.add("weeks",1,1),"undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&TimeScheduler.Options.Start.subtract("days",1,1).add("Milliseconds",1,1)):"1 month"==t.Name?(TimeScheduler.Options.Start=a.startOf("month",1).add("Milliseconds",1,1),TimeScheduler.Options.Start.add("months",1,1).add("Milliseconds",1,1)):"1 days"==t.Name&&(TimeScheduler.Options.Start.add("days",1,1),TimeScheduler.Options.Start.startOf("day",1).add("minutes",60*t.StartPeroid,1))),TimeScheduler.Init()},Cell_Clicked:function(e){var t=$(this),a=TimeScheduler.GetSelectedPeriod(),i=a.TimeframeOverall/a.TimeframePeriod,r=t.offset(),n=t.width(),s=r.left,d=e.pageX-s,l=(d=(d=(d=d/n*100)<0?0:d)>100?100:d)*i/100;"undefined"==typeof parsvt_interface_language||"fa"!==parsvt_interface_language&&"ar"!==parsvt_interface_language||(l=i-1-l),TimeScheduler.Options.Events.Cell_Clicked.call(this,a,l,t.data("section"))},SelectPeriod:function(e){TimeScheduler.Options.SelectedPeriod=e;var t=TimeScheduler.GetSelectedPeriod();if("1 week"==e)TimeScheduler.Options.Start=moment().startOf("week",1).add("Milliseconds",1,1),"undefined"!=typeof parsvtlocale&&"en"!=parsvtlocale&&TimeScheduler.Options.Start.subtract("days",1,1).add("Milliseconds",1,1);else if("1 month"==e)TimeScheduler.Options.Start=moment().startOf("month",1).add("Milliseconds",1,1);else if("1 days"==e)TimeScheduler.Options.Start=moment().startOf("day",1).add("minutes",60*t.StartPeroid,1);else if("Custom"==e){var a=$(".time-sch-period-container").find(".selectedRange").data("date-range"),i=a.split(","),r=i[0],n=i[1],s=$("#CalendarViewContent #date_format").val();if("undefined"==typeof parsvt_calendar||"jalali"!==parsvt_calendar&&"islamic"!==parsvt_calendar)var d=moment(r,s.toUpperCase()),l=moment(n,s.toUpperCase());else{r=vtfarsitools.getDateInstance(r,s),n=vtfarsitools.getDateInstance(n,s);var d=moment(r,s.toUpperCase()).add("months",1,1).add("Milliseconds",1,1),l=moment(n,s.toUpperCase()).add("months",1,1).add("Milliseconds",1,1)}d==l&&l.add("minutes",1440,1);for(var o=l.diff(d,"minutes"),c=0;c<TimeScheduler.Options.Periods.length;c++)if("Custom"===TimeScheduler.Options.Periods[c].Name){TimeScheduler.Options.Periods[c].TimeframeOverall=o,TimeScheduler.Options.Periods[c].DateRange="("+a+")",TimeScheduler.Options.Periods[c].DateRangeValue=a;break}TimeScheduler.Options.Start=d}TimeScheduler.Init()},Period_Clicked:function(e){e.preventDefault(),TimeScheduler.SelectPeriod($(this).data("period").Name)},registerCustomDateFilter:function(e){vtUtils.applyFieldElementsView(e),e.on("click","a.dateRange",function(t){var a=jQuery(t.currentTarget);a.hasClass("rangeDisplay")||(jQuery("a",e).removeClass("time-sch-selected-button"),a.addClass("time-sch-selected-button"))}),e.on("datepicker-change",'a[data-calendar-type="range"]',function(t){var a=jQuery(t.currentTarget),i=a.val().split(","),r=i[0],n=i[1],s=$("#CalendarViewContent #date_format").val();if(parsvt_calendar_scheduler=1,"undefined"==typeof parsvt_calendar||"jalali"!==parsvt_calendar&&"islamic"!==parsvt_calendar)var d=moment(r,s.toUpperCase()),l=moment(n,s.toUpperCase()).add("minutes",1440,1);else{r=vtfarsitools.getDateInstance(r,s),n=vtfarsitools.getDateInstance(n,s);var d=moment(r,s.toUpperCase()).add("months",1,1).add("Milliseconds",1,1),l=moment(n,s.toUpperCase()).add("months",1,1).add("Milliseconds",1,1)}parsvt_calendar_scheduler=0;l.diff(d,"days")>31?app.helper.showErrorNotification({title:app.vtranslate("Limited 31 days"),message:app.vtranslate("Date range should be in a month to show activities better")}):(jQuery("a",e).removeClass("time-sch-selected-button"),a.addClass("time-sch-selected-button"),e.find(".selectedRange").html("("+a.val()+")").closest("button").removeClass("hide"),e.find(".selectedRange").data("date-range",a.val()),$("a.dateRange",e).trigger("click"),TimeScheduler.SelectPeriod("Custom"))})}};