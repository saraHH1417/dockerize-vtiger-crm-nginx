/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
jQuery.Class("ParsVT_LanguageEditor_Js",{},{registerPicklistModulesChangeEvent:function(){var e=this;jQuery("#pickListModules").on("change",function(){var t=$(this).val();if(t.length<=0)Settings_Vtiger_Index_Js.showMessage({type:"error",text:app.vtranslate("JS_PLEASE_SELECT_MODULE")});else{var a={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:t,view:"ListPicklistsAjax",mode:"getPickListDetailsForModule"},r=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(a).then(function(t){t.success&&(jQuery("#modulePickListContainer").html(t.result),r.progressIndicator({mode:"hide"}),app.changeSelectElementView(jQuery("#modulePickListContainer")),e.registerModulePickListChangeEvent(),jQuery("#modulePickList").trigger("change"))})}})},registerModulePickListChangeEvent:function(){var e=this;jQuery("#modulePickList").on("change",function(t){var a={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"ListPicklistsAjax",mode:"getPickListValueForField",pickListFieldId:jQuery(t.currentTarget).val()},r=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(a).then(function(t){jQuery("#modulePickListValuesContainer").html(t.result),r.progressIndicator({mode:"hide"}),e.registerSaveNewPicklistTranslationInputEvent()})})},registerSaveNewPicklistTranslationInputEvent:function(){jQuery("#modulePickListValuesContainer").find(".pickListTranslation").each(function(){jQuery(this).on("blur",function(){var e=$(this).val(),t=$(this).closest("tr").data("lang"),a=$(this).closest("tr").data("key"),r=$("#pickListModules").val(),s=$(this).closest("tr").data("langtranslate"),n={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),action:"SavePicklist",forModule:r,key:a,transString:e,langPrefix:t};s!==e&&AppConnector.request(n).then(function(e){e.result.message;app.helper.showSuccessNotification({message:e.result.message})})})})},registerAddNewLanguageEvent:function(){$("#createLangButton").click(function(e){app.request.get({url:"index.php?module=ParsVT&parent=Settings&view=createLanguageModalAjax"}).then(function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})})})},addNewLanguage:function(e){var t=jQuery.Deferred(),a=e.serializeFormData(),r={type:"POST",module:app.getModuleName(),action:"LanguageAjax",formData:a,mode:"createNewLanguage",dataType:"json"};return AppConnector.request(r).then(function(e){alert(JSON.stringify(e)),alert(3),t.resolve(e)},function(e){t.reject(e)}),t.promise()},registerCopyLanguage:function(){var e=this;jQuery.Deferred();jQuery(document).on("click",".modalSaveButton",function(){if("success"==e.validateCheckCode()){var t=jQuery("#newLanguage"),a=jQuery("#langName");if(0==t.val().length)$(".newLanguageVal")[0]?t.focus():(t.after('<span class="newLanguageVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),t.focus());else if($(".newLanguageVal").remove(),0==a.val().length)$(".langNameVal")[0]?a.focus():(a.after('<span class="langNameVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),a.focus());else{$(".langNameVal").remove();var r=jQuery("#newLanguageForm").serializeFormData(),s=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),n={};n.module=app.getModuleName(),n.action="LanguageAjax",n.parent="Settings",n.mode="createNewLanguage",n.data=r,AppConnector.request(n).then(function(e){s.progressIndicator({mode:"hide"}),e.success?1==e.result.success?app.helper.showSuccessNotification({message:e.result.message}):app.helper.showErrorNotification({message:e.result.message}):app.helper.showErrorNotification({message:ParsVTErrors.OPFAILED})},function(e){s.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.OPFAILED})}),jQuery(".myModal").hide(),setTimeout(function(){window.location.reload(1)},3e3)}}})},registerdeleteLanguage:function(){jQuery(".deleteLanguage").on("click",function(e){var t=jQuery(e.currentTarget).data("langprefix");void 0!==t&&app.helper.showConfirmationBox({message:ParsVTErrors.CONVERTDATACONFIRM}).then(function(e){var a=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),r={};r.module=app.getModuleName(),r.action="DeleteTranslation",r.parent="Settings",r.langPrefix=t,AppConnector.request(r).then(function(e){a.progressIndicator({mode:"hide"}),e.success?1==e.result.success?app.helper.showSuccessNotification({message:e.result.message}):1==e.result.error&&app.helper.showErrorNotification({message:e.result.message}):app.helper.showErrorNotification({message:ParsVTErrors.OPFAILED})},function(e){a.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.OPFAILED})}),setTimeout(function(){window.location.reload(1)},3e3)},function(e,t){return!1})})},registerCopyLanguageEvent:function(){jQuery("#allLanguages");jQuery(".copyLanguage").each(function(){jQuery(this).click(function(e){var t="index.php?module=ParsVT&parent=Settings&view=createLanguageModalAjax&language="+jQuery(this).closest("tr").data("prefix")+","+jQuery(this).closest("tr").data("label");app.request.get({url:t}).then(function(e,t){null===e?app.helper.showModal(t):app.helper.showErrorNotification({message:e.message})}),e.stopPropagation()})})},aftervalidformaction:function(e){var t=e.find(":submit");t.attr("disabled","disabled"),this.addNewLanguage(e).then(function(e){var a={text:e.result.message};!0===e.result.success?(a.type="info",app.hideModalWindow()):!1===e.result.success&&(a.type="error",t.attr("disabled",!1)),Vtiger_Helper_Js.showMessage(a),window.location.reload()},function(e,t){})},registerLangButtonEvent:function(){$(".langButton").click(function(e){var t=$(this).closest("tr").data("prefix"),a=$(this).closest("tr").data("name"),r=$(this).closest("tr").data("label"),s={type:"POST",module:app.getModuleName(),parent:"Settings",action:"LanguageAjax",name:a,label:r,prefix:t,mode:"changeActiveStatusOfLanguage",dataType:"json"};AppConnector.request(s).then(function(e){1==e.success?app.helper.showSuccessNotification({message:e.result.message}):e.error&&app.helper.showErrorNotification({message:e.error.code})},function(e){progressIndicatorElement.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.OPFAILED})}),setTimeout(function(){window.location.reload(1)},3e3)})},registerRowClickEvent:function(){jQuery(".listViewEntries").on("click",function(e){var t=jQuery(e.currentTarget).data("recordurl");void 0!==t&&(window.location.href=t)})},validateCheckCode:function(){var e="error",t=jQuery("#langCode");return/^([a-z]{2}[_]{1}[a-zA-Z]{2})$/.test(t.val())&&0!=t.val().length?($(".langCodeVal").remove(),e="success"):$(".langCodeVal")[0]?t.focus():(t.after('<span class="langCodeVal text-danger">'+app.vtranslate("JS_PLEASE_ENTER_VALID_VALUE")+"</span>"),t.focus(),e="error"),e},registerEvents:function(){this.registerPicklistModulesChangeEvent(),this.registerModulePickListChangeEvent(),this.registerSaveNewPicklistTranslationInputEvent(),this.registerAddNewLanguageEvent(),this.registerLangButtonEvent(),this.registerCopyLanguage(),this.registerCopyLanguageEvent(),this.registerdeleteLanguage()}}),jQuery(document).ready(function(){(new ParsVT_LanguageEditor_Js).registerEvents()});