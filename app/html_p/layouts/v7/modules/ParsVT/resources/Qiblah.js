/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
var printer,curCenter,mymap,mapnode,mapw,maph,myIcon,control,theplace="",d=new Date,wd=d.getDay(),theloc='<img src="layouts/v7/modules/ParsVT/resources/map/images/kabah_panorama_cr.jpg" /><h4>Makkeh</h4>',thelat=21.42249,thelong=39.82618,kabah=new L.LatLng(thelat,thelong),place=new L.LatLng(-6-35/60-.0125,106+47/60+49/3600),placename="ParsVT Office",countryname="Iran",jarakmekah="1708 km";$(document).ready(function(){geoip_latitude&&(theloc="<b>"+geoip_placename+"</b>",countryname=geoip_country_name,placename=geoip_placename,place=new L.LatLng(geoip_latitude/1,geoip_longitude/1)),mymap=L.map("map").setView([place.lat,place.lng],13),myIcon=L.icon({iconUrl:"layouts/v7/modules/ParsVT/resources/map/images/qibla-wind-direction.png",iconSize:[100,100],iconAnchor:[50,50],popupAnchor:[-3,-76]}),control=L.control.geonames({position:"topright",geonamesSearch:"https://secure.geonames.org/searchJSON",geonamesPostalCodesSearch:"https://secure.geonames.org/postalCodeSearchJSON",username:"alhabib",maxresults:5,zoomLevel:null,className:"leaflet-geonames-icon",workingClass:"leaflet-geonames-icon-working",featureClasses:["A","P"],baseQuery:"isNameRequired=true",showMarker:!1,showPopup:!1,adminCodes:{},bbox:{},lang:"fa",alwaysOpen:!0,enablePostalCodes:!1,postalCodesRegex:POSTALCODE_REGEX_US,title:app.vtranslate("Find location"),placeholder:app.vtranslate("Enter place name")}),mymap.addControl(control),control.on("select",function(e){mymap.setView([e.geoname.lat,e.geoname.lng],13),countryname=e.geoname.countryName,placename=e.geoname.name+(e.geoname.adminName1?", "+e.geoname.adminName1:""),$("#namatempat").html(placename),t.update()}),mymap.on("move",function(){curCenter=mymap.getCenter(),$("#namatempat").html("Latitude "+curCenter.lat.toFixed(2)+" Longitude "+curCenter.lng.toFixed(2))});L.tileLayer.provider("OpenStreetMap.Mapnik").addTo(mymap);var e=L.marker(kabah,{draggable:!1}).addTo(mymap),a=L.marker(place,{icon:myIcon,draggable:!0}).addTo(mymap);$("#namatempat").html(placename);var t=L.geodesic([[a.getLatLng(),e.getLatLng()]],{weight:5,opacity:1,color:"red",steps:50}).addTo(mymap),n=L.control({position:"bottomright"});n.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},n.update=function(){this._div.innerHTML='<a style="background: #fff" href="http://parsvt.com">ParsVT.com</a>'},n.addTo(mymap),t.update=function(){a.setLatLng(mymap.getCenter()),t.setLatLngs([[a.getLatLng(),e.getLatLng()]]),function(e){curCenter=mymap.getCenter(),$("#curLat").html(curCenter.lat.toFixed(7)),$("#curLong").html(curCenter.lng.toFixed(7));var a=e?e.distance>1e4?(e.distance/1e3).toFixed(0)+" km":e.distance.toFixed(0)+" m":"invalid",t=e?e.initialBearing<0?(360+e.initialBearing).toFixed(0)+"&deg; ":e.initialBearing.toFixed(0)+"&deg; ":"invalid";$("#jarakmekah").html(a),$("#arahkiblat").html(t)}(t._vincenty_inverse(a.getLatLng(),e.getLatLng()))},t.update(),mymap.on("move",t.update)});