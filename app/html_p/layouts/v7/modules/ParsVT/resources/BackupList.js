/* ********************************************************************************
 * The content of this file is subject to the VTFarsi.ir Modules License("License");
 * You may not use this file except in compliance with the License
 * The Initial Developer of the Original Code is VTFarsi.ir
 * Portions created by VTFarsi.ir. are Copyright(C) VTFarsi Team
 * All Rights Reserved.
 * ****************************************************************************** */
jQuery(".switch").bootstrapSwitch(),jQuery.Class("BackupList_Js",{},{registerEventForBackupButton:function(){jQuery("#btn_delete").on("click",function(){return!$("input:radio[name=rbSelect]:checked").val()?(app.helper.showErrorNotification({message:ParsVTErrors.SELECTBACKUPFILE}),!1):""==$("#adminpassword").val()?(app.helper.showErrorNotification({message:ParsVTErrors.ADMINPASSWORD}),!1):void app.helper.showConfirmationBox({message:ParsVTErrors.DELETECONFIRM}).then(function(e){var r=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),o={},s=$("input:radio[name=rbSelect]:checked").val();o.filename=s,o.password=$("#adminpassword").val(),o.module=app.getModuleName(),o.action="DBOperation",o.mode="deleteBackup",o.parent="Settings",AppConnector.request(o).then(function(e){r.progressIndicator({mode:"hide"}),e.success&&e.result.success?(app.helper.showSuccessNotification({message:e.result.message}),setTimeout(function(){window.location="index.php?module=ParsVT&view=Database&parent=Settings&mode=backup"},3e3)):e.success&&e.result.errormessage?app.helper.showErrorNotification({message:e.result.errormessage}):app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR})},function(e){r.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR})})},function(e,r){return!1})}),jQuery("#downloadbackup").on("click",function(){if(!!!$("input:radio[name=rbSelect]:checked").val())return app.helper.showErrorNotification({message:ParsVTErrors.SELECTBACKUPFILE}),!1;if(""==$("#adminpassword").val())return app.helper.showErrorNotification({message:ParsVTErrors.ADMINPASSWORD}),!1;var e={},r=$("input:radio[name=rbSelect]:checked").val();e.module=app.getModuleName(),e.action="DBOperation",e.mode="downloadBackup",e.parent="Settings",e.filename=btoa(r),e.password=btoa($("#adminpassword").val());var o=jQuery.param(e);window.open("index.php?"+o,"Download Backup","width=600, height=400, left=100, top=100, resizable=yes, scrollbars=yes")}),jQuery("#btn_restore").on("click",function(){return!$("input:radio[name=rbSelect]:checked").val()?(app.helper.showErrorNotification({message:ParsVTErrors.SELECTBACKUPFILE}),!1):""==$("#adminpassword").val()?(app.helper.showErrorNotification({message:ParsVTErrors.ADMINPASSWORD}),!1):void app.helper.showConfirmationBox({message:ParsVTErrors.RESTORECONFIRM}).then(function(e){var r=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),o={},s=$("input:radio[name=rbSelect]:checked").val();o.filename=s,o.password=$("#adminpassword").val(),o.module=app.getModuleName(),o.action="DBOperation",o.mode="restoreBackup",o.parent="Settings",AppConnector.request(o).then(function(e){r.progressIndicator({mode:"hide"}),e.success&&e.result.success?app.helper.showSuccessNotification({message:e.result.message}):e.success&&e.result.errormessage?app.helper.showErrorNotification({message:e.result.errormessage}):app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR})},function(e){r.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR})})},function(e,r){return!1})}),jQuery(".btn-backup").on("click",function(){var e=jQuery.progressIndicator({message:"",position:"html",blockInfo:{enabled:!0}}),r={};r.module=app.getModuleName(),r.action="DBOperation",r.mode="generateBackup",r.parent="Settings",AppConnector.request(r).then(function(r){e.progressIndicator({mode:"hide"}),r.success&&r.result.success?app.helper.showSuccessNotification({message:r.result.message}):r.success&&r.result.errormessage?app.helper.showErrorNotification({message:r.result.errormessage}):app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR}),setTimeout(function(){window.location="index.php?module=ParsVT&view=Database&parent=Settings&mode=backup"},3e3)},function(r){e.progressIndicator({mode:"hide"}),app.helper.showErrorNotification({message:ParsVTErrors.UNKNOWNERR})})})},OpenWindowWithPost:function(e,r,o,s){var t=document.createElement("form");t.setAttribute("method","post"),t.setAttribute("action",e),t.setAttribute("target",o);for(var a in s)if(s.hasOwnProperty(a)){var n=document.createElement("input");n.type="hidden",n.name=a,n.value=s[a],t.appendChild(n)}document.body.appendChild(t),window.open("index.php",o,r),t.submit(),document.body.removeChild(t)},showNotify:function(e){var r={title:app.vtranslate("JS_MESSAGE"),text:e.text,animation:"show",type:e.type};Vtiger_Helper_Js.showPnotify(r)},registerEvents:function(){this.registerEventForBackupButton()}}),jQuery(document).ready(function(){(new BackupList_Js).registerEvents()});