## آموزش توسعه ماژول وب هوک

برای استفاده از ماژول وب هوک در ماژول ها و بخش های دیگر ویتایگر بدون استفاده از گردش کار می توانید از راهنمای زیر استفاده نمایید


 - sendRequest برای ارسال یک درخواست Soap  یا Rest

همچنین برای استفاده از وب سرویس های بر پایه Soap توابع زیر نیز در دسترس شما قرار داد


 - checkSoapURL برای دریافت متدهای در دسترسی یک آدرس wsdl
 - getSoapFunctionParams  برای دریافت پارامترهای یک متد در آدرس wsdl
 
 <a href="modules/WebHook/resources/examples.zip">
#####برای مشاهده نمونه کدهای قابل استفاده به زبان PHP اینجا را کلیک کنید.
</a>

###متد sendRequest

این تابع به شما اجازه میدهد یک درخواست بر پایه Soap یا Rest را ارسال و پاسخ آنرا مشاهده و دریافت نمایید. همچنین شما این قابلیت را دارید تا این درخواست را با یک رکورد در ویتایگر مرتبط کرده و پاسخ درخواست را در صورت اجرای موفق در فیلد های رکورد فراخوانی شده بروزرسانی نمایید

نحوه فراخوانی این تابع به صورت زیر می باشد

```
WebHook_API_Helper::sendRequest($requestParams, $bodyParameters, $headerParameters, $record)
```

#####پارامتر $requestParams براساس نوع متد Soap یا Rest به دو صورت مختلف مقدار دهی می گردد

در صورتی که درخواست شما بر پایه Rest می باشد درخواست شما باید شامل پارامتر های زیر باشد
```
$requestParams = array(
    'url' => 'آدرس وب سرویس',
    'method' => 'نوع متد درخواست',
    'type' => ' سرآیند Content-Type ',
    'authentication' => 'نوع متد احراز هویت',
    'username' => 'نام کاربری در صورت داشتن احراز هویت',
    'password' => 'پسورد در صورت داشتن احراز هویت',
    'token' => 'توکن اختصاصی در صورت داشتن احراز هویت',
    'ssl' => 'بررسی برای چک کردن اس اس ال',
    'timeout' => 'حداکثر زمان برای ارسال درخواست',
);
```
 - پارامتر url باید با آدرس وب سرویس مقدار دهی گردد
 - پارامتر method باید با نوع متد ارسال درخواست مقدار دهی گردد. این پارامتر شامل یکی از مقادیر زیر خواهد بود:
POST, PUT, GET, DELETE, PATCH, OPTIONS, HEAD
 - پارامتر type باید با سرآیند Content-Type مقدار دهی گردد. . این پارامتر شامل یکی از مقادیر زیر خواهد بود
    + مقدار FORM برای ارسال با سرآیند application/x-www-form-urlencoded
    + مقدار XML برای ارسال با سرآیند application/xml و تبدیل پارامترهای درخواست به فرمت XML
    + مقدار JSONARRAY برای ارسال با سرآیند application/json و ارسال پارامترها به صورت رشته json از پارامترهای درخواست در داخل یک آرایه
    + مقدار JSON برای ارسال با سرآیند application/json ارسال پارامترها به صورت رشته json
 - پارامتر authentication در صورتی که وب سرویس مورد استفاده نیازمند احرازهویت بود با یکی از مقادیر زیر تکمیل خواهد شد در غیر این صورت نیازی با ارسال این پارامتر در درخواست نمی باشد:
    + NO در صورتی که نیاز به احراز هویت وجود نداشت
    + Basic برای احراز هویت [Basic](https://fa.wikipedia.org/wiki/%D8%A7%D8%B5%D8%A7%D9%84%D8%AA%E2%80%8C%D8%B3%D9%86%D8%AC%DB%8C_%D8%A8%D8%B1%D8%A7%DB%8C_%D8%AF%D8%B3%D8%AA%D8%B1%D8%B3%DB%8C%E2%80%8C%D9%87%D8%A7%DB%8C_%D8%A7%D9%88%D9%84%DB%8C%D9%87)
    + NTLM برای احراز هویت [NTLM](https://en.wikipedia.org/wiki/NT_LAN_Manager)
    + DIGEST برای احراز هویت [DIGEST](https://fa.wikipedia.org/wiki/%D8%A7%D8%AD%D8%B1%D8%A7%D8%B2_%D9%87%D9%88%DB%8C%D8%AA_%D9%85%D8%AE%D8%AA%D8%B5%D8%B1)
    + CUSTOM برای احراز هویت هایی که شامل موارد بالا نیستند و به عنوان مثال [OAuth 2.0](https://swagger.io/docs/specification/authentication/bearer-authentication/)
 - پارامتر های username و password در صورتی که از یکی از احراز هویت های Basic, NTLM, DIGEST استفاده می کنید باید مقداردهی شوند در غیر این صورت نیازی با ارسال این پارامترها در درخواست نمی باشد
 - پارامتر token در صورتی که از احراز هویت CUSTOM استفاده می کنید باید مقداردهی شود در غیر این صورت نیازی با ارسال این پارامتر در درخواست نمی باشد
 - پارامتر ssl در صورتی که آدرس صفحه وب سرویس باhttps شروع شده باشد و این مقدار برابر true باشد در زمان اتصال و ارسال درخواست certificate سرور دریافت و اعتبارسنجی می شود. در صورت مقداردهی نکردن یا صرف نظر کردن از آن مقدار آن برابر با false خواهد بود.
 - پارامتر timeout حداکثر زمانی که درخواست برای دریافت پاسخ از سمت سرور منتظر می ماند را مشخص میکند در صورتی که این پارامتر را وارد نکنید به صورت پیش فرض زمان 30 ثانیه در نظر گرفته می شود.

در صورتی که درخواست شما بر پایه Soap می باشد درخواست شما باید شامل پارامتر های زیر باشد
```
$requestParams = array(
    'url' => 'آدرس وب سرویس',
    'method' => 'POST',
    'type' => 'SOAP',
    'authentication' => 'نوع متد احراز هویت',
    'username' => 'نام کاربری در صورت داشتن احراز هویت',
    'password' => 'پسورد در صورت داشتن احراز هویت',
    'timeout' => 'حداکثر زمان برای ارسال درخواست',
    'function' => 'نام عملیات',
    'soap_version' => 'ورژن soap'
);
```

 - پارامتر url باید با آدرس wsdl مقدار دهی گردد
 - پارامتر method باید با مقدار POST مقداردهی شود.
 - پارامتر type باید با مقدار SOAP مقدار دهی شود
 - پارامتر authentication در صورتی که وب سرویس مورد استفاده نیازمند احرازهویت بود با یکی از مقادیر زیر تکمیل خواهد شد در غیر این صورت نیازی با ارسال این پارامتر در درخواست نمی باشد:
    + NO در صورتی که نیاز به احراز هویت وجود نداشت
    + Basic برای احراز هویت [Basic](https://fa.wikipedia.org/wiki/%D8%A7%D8%B5%D8%A7%D9%84%D8%AA%E2%80%8C%D8%B3%D9%86%D8%AC%DB%8C_%D8%A8%D8%B1%D8%A7%DB%8C_%D8%AF%D8%B3%D8%AA%D8%B1%D8%B3%DB%8C%E2%80%8C%D9%87%D8%A7%DB%8C_%D8%A7%D9%88%D9%84%DB%8C%D9%87)
 - پارامتر های username و password در صورتی که از احراز هویت Basic استفاده می کنید باید مقداردهی شوند در غیر این صورت نیازی با ارسال این پارامترها در درخواست نمی باشد
 - پارامتر timeout حداکثر زمانی که درخواست برای دریافت پاسخ از سمت سرور منتظر می ماند را مشخص میکند در صورتی که این پارامتر را وارد نکنید به صورت پیش فرض زمان 30 ثانیه در نظر گرفته می شود.
 - پارامتر function باید با اسم عملیات و تابعی که در فایل wsdl فراخوانی میکنید مقداردهی شود.
 - پارامتر soap_version باید با ورژن های مورد پشتیبانی آدرس wsdl مقدار دهی شود. برای استفاده از توابع Soap در ماژول وب هوک باید ورژن آدرس wsdl را بدانید

در حال حاضر ورژن های قابل استفاده شامل 1.0 ، 1.1 و 1.2 می باشند و در صورتی که ورژن wsdl را نمی دانید مقدار آن را بر روی Auto جهت شناسایی خودکار قرار دهید

#####پارامتر $bodyParameters باید به صورت یک ارایه از پارامترهای بدنه درخواست ارسال شود.
#####پارامتر $headerParameters باید به صورت یک ارایه از پارامترهای هدر درخواست ارسال شود. در صورتی که هدر درخواست شما مقادیر خاصی ندارد آن را به صورت یک آرایه خالی مقدار دهی کنید.
#####پارامتر $record به صورت یک ارایه در زمان ارسال مقدار دهی می شود. در صورتی که بخواهید درخواست را به یک رکورد در سی آر ام مرتبط کنید یا در صورت ارسال موفق درخواست پاسخ دریافت شده از سمت وب سرور را در فیلدهای از رکورد مرتبط مقدار دهی کنید باید این پارامتر را مقداردهی نمایید در غیر این صورت نیازی به ارسال و فراخوانی آن نخواهید داشت.
مقدار پارامتر $record در درخواست شما باید شامل پارامتر های زیر باشد
```
$record = array(
    'wsid' => 'شناسه وب سرویس رکورد',
    'update_mapping' => array(
        array(
            'fieldname' => 'نام فیلد در ویتایگر',
            'value' => 'مسیر پاسخ دریافتی از وب سرور'
        ),
        array(
            'fieldname' => 'نام فیلد در ویتایگر',
            'value' => 'مسیر پاسخ دریافتی از وب سرور'
        ),
	.....
    ),
);
```
 <a href="modules/WebHook/resources/examples.zip">
برای اطلاعات بیشتر و دریافت نمونه کد های آماده به زبان PHP اینجا را کلیک کنید.
</a>

###متد checkSoapURL

این تابع به شما اجازه میدهد لیست متدهای در دسترس در یک آدرس wsdl را مشاهده و دریافت نمایید

نحوه فراخوانی این تابع به صورت زیر می باشد

```
WebHook_API_Helper::checkSoapURL(WSDL_URL,SOAP_VERSION);
```

 - مقدار WSDL_URL با آدرس wsdl سرور soap و SOAP_VERSION با ورژن تحت پشتیبانی سرور soap تکمیل می شود
 - این مقدار می توانید با یکی از مقادیر 1.0 ، 1.1 و 1.2 تکمیل شود و در صورت خالی بودن به صورت خودکار مقدار Auto را جهت شناسایی خودکار ورژن می گیرد

###متد getSoapFunctionParams

این تابع به شما اجازه میدهد لیست پارامترهای یک متد آدرس wsdl را مشاهده و دریافت نمایید.

نحوه فراخوانی این تابع به صورت زیر می باشد

```
WebHook_API_Helper::getSoapFunctionParams(WSDL_URL, WSDL_OPERATION, SOAP_VERSION, WSDL_USERNAME, WSDL_PASSWORD)
```

 - مقدار WSDL_URL با آدرس wsdl سرور soap مقداردهی می شود
 - مقدار WSDL_OPERATION با نام عملیات درخواستی در سرور soap مقداردهی می شود
 - مقدار SOAP_VERSION با ورژن تحت پشتیبانی سرور soap تکمیل می شود. این مقدار الزامی نمی باشد.
این مقدار می توانید با یکی از مقادیر 1.0 ، 1.1 و 1.2 تکمیل شود و در صورت خالی بودن به صورت خودکار مقدار Auto را جهت شناسایی خودکار ورژن می گیرد
 - مقدار WSDL_USERNAME در صورتی که عملیات در خواستی در سرور نیازمند احزارهویت Basic Authentication باشد این مقدار با نام کاربری سرور soap مقداردهی می شود. این مقدار الزامی نمی باشد و در صورتی که سرور شما احراز هویت Basic ندارد نیازی به وارد کردن آن نخواهید داشت
 - مقدار WSDL_PASSWORD در صورتی که عملیات در خواستی در سرور نیازمند احزارهویت Basic Authentication باشد این مقدار پسورد سرور soap مقداردهی می شود. این مقدار الزامی نمی باشد. و در صورتی که سرور شما احراز هویت Basic ندارد نیازی به وارد کردن آن نخواهید داشت.